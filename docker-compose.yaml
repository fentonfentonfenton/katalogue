version: "3.7"
services:
  whiskerboard:
    image: rickpeters/whiskerboard
    ports:
      - "8000:8000"
      - "8080:8080"
    links:
      - postgres
      - redis
    command: /usr/local/bin/supervisord -c /usr/src/python/whiskerboard/config/supervisor.conf
    volumes:
      - ./whiskerboard/logs:/whiskerboard/logs
      - ./images/:/usr/src/python/whiskerboard/board/static/images
      - ./templates:/usr/src/python/whiskerboard/board/templates
      - ./css:/usr/src/python/whiskerboard/board/static/css
      - ./config:/usr/src/python/whiskerboard/config
  postgres:
    image: postgres:9.3
    volumes:
      - ./pgdata/data:/data
      - ./pgdata/log:/var/log/postgresql
  redis:
    image: redis:2.8
    command: redis-server
    volumes:
      - ./redis:/data
  golang:
    image: golang:buster
    command: sh -c "
        go get gopkg.in/qntfy/kazaam.v3 ;
        cd /go/src/gopkg.in/qntfy/kazaam.v3/kazaam ;
        go install ;
        kazaam -in /go/mocks/project.json -out /go/mocks/project_transformed.json -spec /go/mocks/project_transform.json ;
        kazaam -in /go/mocks/service.json -out /go/mocks/service_transformed.json -spec /go/mocks/service_transform.json ;
        sh /go/mocks/curl.sh
        "
    links:
      - whiskerboard
    volumes:
      - ./mocks:/go/mocks
